# Build process

## Prerequisites
These prerequisites are not strict but reflect an actual build environment.

 - Ubuntu 16.04.2 LTS
 - OpenJDK Java 1.8.0_131
 - Apache Maven 3.3.9
 - Node.js v4.2.6
 - NPM 3.5.2

## Build environment setup

### Install OpenJDK
~~~bash
sudo apt-get install openjdk-8-jdk
~~~

### Install Maven
~~~bash
sudo apt-get install maven
~~~

### Install Node.js, NPM and additional packages
Install Node.js and make symlink since some NPM packages (like `karma-jasmine-jquery`) depend on it
~~~bash
sudo apt-get install nodejs
sudo ln -s /usr/bin/nodejs /usr/bin/node
~~~

Install NPM
~~~bash
sudo apt-get install npm
~~~

Install `libfontconfig` since PhantomJS relies on it
~~~bash
sudo apt-get install libfontconfig
~~~

Install `bzip2` since some NPM packages (like PhantomJS when extracting its distro) require this
~~~bash
sudo apt-get install bzip2
~~~

Install NPM packages globally
~~~bash
sudo npm install -g karma-cli
sudo npm install -g karma
sudo npm install -g jasmine-core
sudo npm install -g karma-jasmine
sudo npm install -g karma-junit-reporter
sudo npm install -g karma-jasmine-jquery
sudo npm install -g karma-jasmine-ajax
sudo npm install -g karma-coverage
sudo npm install -g karma-phantomjs2-launcher
sudo npm install -g coffee-script@1.8.0
sudo npm install -g bower-installer@0.8.4
~~~

## Build
Project is divided into Frontend and Backend maven modules. Backend module depends on Frontend thus requiring it to be build first.

Please check out project from GIT and cd into project directory.

### Frontend
Frontend is a Angular 4 module generated by Angular CLI version 1.0.4. It can be built using maven from within `frontend` directory.
**NOTE!** Following commands are executed inside `frontend` directory.

#### Install node modules and yarn
~~~bash
mvn frontend:install-node-and-yarn frontend:yarn
~~~

#### Install bower
Build process requires bower. Please note that bower can't run as root user or using sudo. If you absolutely have to, add `{ "allow_root": true }` to `~/.bowerrc`.
~~~bash
echo "{ \"allow_root\": true }" > ~/.bowerrc
~~~

Install bower
~~~bash
mvn frontend:yarn@install-bower
~~~

#### Build using maven
Build project using maven `frontend:yarn` task and calling `build` script from `package.json`. Compiled artifacts will be outputted to the `dist` directory.
~~~bash
mvn frontend:yarn@build
~~~

Build can be executed with parameters. For example, when building for production environment, following syntax can be used:
~~~bash
mvn frontend:yarn@args -Dyarn.args="run build -- -prod"
~~~
This will result in `yarn run build -- -prod` command being called which in effect will run `ng build -prod`.
